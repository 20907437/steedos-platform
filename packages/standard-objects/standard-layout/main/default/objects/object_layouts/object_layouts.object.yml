name: object_layouts
label: Object Layouts
icon: dashboard_ea
hidden: true
fields:    
  label:
    type: text
    required: true
    label: Label
    is_wide: true
    is_name: true
  object_name:
    label: Object
    type: master_detail
    required: true
    reference_to: objects
    reference_to_field: name
    write_requires_master_read: true
    optionsFunction: !<tag:yaml.org,2002:js/function> |-
      function () {
              var _options = [];
              _.forEach(Creator.objectsByName, function (o, k) {
                return _options.push({
                  label: o.label,
                  value: k,
                  icon: o.icon
                });
              });
              return _options;
            }
  profiles:
    # TODO profile 上也记录layout
    type: lookup
    label: Profile
    showIcon: false
    multiple: true
    required: true
    create: false
    optionsFunction: !!js/function |
      function () {
        var profiles = Creator.odata.query('permission_set', {$filter: "(type eq 'profile')"}, true);
        var result = [];
        profiles.forEach(function (item) {
          result.push({
            label: item.label,
            value: item.name
          });
        });
        return result;
      }
  buttons:
    type: grid
    is_wide: true
    required: true
  buttons.$.button_name:
    type: lookup 
    label: Exclude Standard Actions
    is_wide: true
    multiple: true
    optionsFunction: !<tag:yaml.org,2002:js/function> |-
      function (values) {
              var _options = [];
              _.each(Creator.getObject('base').actions, function(v, k){
                _options.push({label: v.label || v.name, value: k});
              })
              return _options;
            }
  buttons.$.visible_on:
    type: text
    label: visible on
  compact_layout_fields:
    label: Compact Layout Fields
    type: lookup
    multiple: false
    max: 10 #最大10个字段
    is_wide: false
    required: true
    reference_to: object_fields
    reference_to_field: name
    depend_on:
      - object_name
    optionsFunction: !<tag:yaml.org,2002:js/function> |-
      function (values) {
          console.log('values', values);
              if (!(values != null ? values.object_name : void 0)) {
                values.object_name = Session.get("object_name");
              }
              console.log('values.object_name2', values.object_name, !_.isString(values.object_name));
              if(values.object_name && !_.isString(values.object_name)){
                console.log('values.object_name3', values.object_name);
                values.object_name = values.object_name.name
              }
              console.log('values.object_name', values.object_name);
              return Creator.getObjectFieldOptions(values != null ? values.object_name : void 0, true);
            }
  template:
    type: text 
    # TODO
list_views:
  all:
    columns:
      - label
      - object_name
      - profiles
    label: All
    filter_scope: space
permission_set:
  user:
    allowCreate: false
    allowDelete: false
    allowEdit: false
    allowRead: false
    modifyAllRecords: false
    viewAllRecords: false
  admin:
    allowCreate: false
    allowDelete: false
    allowEdit: false
    allowRead: false
    modifyAllRecords: false
    viewAllRecords: false